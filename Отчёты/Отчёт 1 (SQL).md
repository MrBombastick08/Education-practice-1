# Отчет по SQL-части проекта "Управление производством"

## 1. Введение

Данный отчет посвящен анализу и описанию структуры базы данных (БД) проекта, разработанного для автоматизации учета и управления производством на мебельном предприятии. Основная цель БД — обеспечить надежное хранение данных о продукции, материалах, цехах и расчетах, необходимых для производственного процесса.

## 2. Технологический стек

Проект использует реляционную модель данных, реализованную с помощью:

*   **Система управления базами данных (СУБД):** Предположительно **PostgreSQL** (на что указывают типы данных `SERIAL` и `TEXT` в `DataBase.sql`).
*   **ORM (Object-Relational Mapping):** **SQLAlchemy** (используется во Flask-приложении через `models.py`).
*   **Типы данных:** Активно используется тип `DECIMAL(P, S)` для хранения финансовых показателей (`min_cost_for_partner`) и критически важных коэффициентов (`coefficient`, `waste_percentage`), что обеспечивает высокую точность расчетов и предотвращает ошибки округления, присущие стандартному типу `FLOAT`.

## 3. Структура базы данных (Схема)

База данных состоит из пяти основных таблиц, связанных между собой для формирования полной картины производственного процесса.

### 3.1. Таблица `product_types` (Типы продукции)

| Поле | Тип данных | Описание | Примечание |
| :--- | :--- | :--- | :--- |
| `id` | `SERIAL` | Первичный ключ | Автоинкремент |
| `name` | `VARCHAR(100)` | Название типа продукции (напр., "Гостиные", "Кухни") | Уникальное, не может быть NULL |
| `coefficient` | `DECIMAL(5, 2)` | Коэффициент расхода сырья для данного типа продукции | Используется в калькуляторе сырья, по умолчанию 1.0 |

### 3.2. Таблица `material_types` (Типы материалов)

| Поле | Тип данных | Описание | Примечание |
| :--- | :--- | :--- | :--- |
| `id` | `SERIAL` | Первичный ключ | Автоинкремент |
| `name` | `VARCHAR(100)` | Название материала (напр., "Ламинированное ДСП", "Фанера") | Уникальное, не может быть NULL |
| `waste_percentage` | `DECIMAL(5, 2)` | Процент потерь материала при производстве | Используется в калькуляторе сырья, по умолчанию 0.0 |

### 3.3. Таблица `workshops` (Цеха)

| Поле | Тип данных | Описание | Примечание |
| :--- | :--- | :--- | :--- |
| `id` | `SERIAL` | Первичный ключ | Автоинкремент |
| `name` | `VARCHAR(200)` | Название цеха | Уникальное, не может быть NULL |
| `worker_count` | `INTEGER` | Количество работников в цехе | По умолчанию 0 |

### 3.4. Таблица `products` (Продукция)

Это центральная таблица, хранящая детальную информацию о каждом изделии.

| Поле | Тип данных | Описание | Связь |
| :--- | :--- | :--- | :--- |
| `id` | `SERIAL` | Первичный ключ | |
| `article` | `VARCHAR(50)` | Артикул продукции | Уникальное, не может быть NULL |
| `product_type_id` | `INTEGER` | Ссылка на тип продукции | `FOREIGN KEY` на `product_types.id` |
| `name` | `VARCHAR(200)` | Название изделия | |
| `description` | `TEXT` | Детальное описание | |
| `min_cost_for_partner` | `DECIMAL(10, 2)` | Минимальная стоимость для партнера | |
| `main_material_id` | `INTEGER` | Ссылка на основной материал | `FOREIGN KEY` на `material_types.id` |
| `parameter1`, `parameter2` | `DECIMAL(10, 2)` | Дополнительные параметры (напр., длина/ширина) | Используются в расчетах |
| `production_time` | `DECIMAL(10, 2)` | Общее время производства | Рассчитывается автоматически |
| `cost_price` | `DECIMAL(10, 2)` | Себестоимость | |
| `created_at`, `updated_at` | `TIMESTAMP` | Даты создания и последнего обновления | |

### 3.5. Таблица `product_workshops` (Связь Продукция-Цех)

Эта таблица реализует связь **Многие-ко-Многим** между продукцией и цехами, так как одно изделие может проходить обработку в нескольких цехах, и один цех может обрабатывать множество изделий.

| Поле | Тип данных | Описание | Связь |
| :--- | :--- | :--- | :--- |
| `id` | `SERIAL` | Первичный ключ | |
| `product_id` | `INTEGER` | Ссылка на продукцию | `FOREIGN KEY` на `products.id` |
| `workshop_id` | `INTEGER` | Ссылка на цех | `FOREIGN KEY` на `workshops.id` |
| `time_in_workshop` | `DECIMAL(10, 2)` | Время, затрачиваемое на обработку в данном цехе | |
| `worker_count` | `INTEGER` | Количество работников, задействованных в этом цехе | По умолчанию 1 |

## 4. Ключевые связи и индексы

### 4.1. Связи (Foreign Keys)

| Таблица-источник | Поле-источник | Таблица-цель | Поле-цель | Тип связи |
| :--- | :--- | :--- | :--- | :--- |
| `products` | `product_type_id` | `product_types` | `id` | Один-ко-Многим (ON DELETE CASCADE) |
| `products` | `main_material_id` | `material_types` | `id` | Один-ко-Многим (ON DELETE SET NULL) |
| `product_workshops` | `product_id` | `products` | `id` | Многие-ко-Многим (ON DELETE CASCADE) |
| `product_workshops` | `workshop_id` | `workshops` | `id` | Многие-ко-Многим (ON DELETE CASCADE) |

### 4.2. Индексы

Для оптимизации скорости поиска и запросов созданы следующие индексы:

*   `idx_products_article`: Ускоряет поиск по артикулу.
*   `idx_products_type`: Ускоряет фильтрацию продукции по типу.
*   `idx_product_workshops_product` и `idx_product_workshops_workshop`: Ускоряют запросы, связанные с поиском цехов для конкретной продукции и наоборот.

## 5. Вывод

Структура БД спроектирована логично и эффективно для решения задач производственного учета. Использование точных типов данных (`DECIMAL`) для ключевых финансовых и расчетных полей, а также грамотное применение связей и индексов, обеспечивает надежность и производительность системы. Модель данных полностью соответствует требованиям ORM SQLAlchemy, что упрощает разработку бизнес-логики приложения.

